# Основное

Приложение представляет собой бэкенд http веб сервиса для ведения списка дел.
Реализовано на языке java на фреймворке spring boot с системой сборки gradle.
Для запуска нужна java и локальный постгрес(настройки подключения нужно 
указать в файле [application.yml](./application.yml))

Для запуска нужно выполнить следующие команды
```shell
./gradlew update # Запуск миграций в локальной бд
./gradlew build # Сборка проекта
java -jar ./build/libs/todolist-x.jar
```

# Выполненные требования

## 1

### Приложение поддерживает аутентификацию пользователей и контроль доступа к API (0.66 балла)

Поддерживается регистрация через электронную почту(но нужно иметь почту с 
2-факторной аутентификацией и сгенерированным паролем для приложений) и 
через лог(в лог пишется id, который нужно прислать в специальную ручку для 
подтверждения).
Аутентификация реализована через spring-security и работает с помощью 
внутренних механизмов спринга(при логине в cookie 
`JSESSIONID` проставляется id авторизованной сессии и пользователь какое-то 
время с этим cookie может пользоваться api без ограничений).
Зарегистрированные пользователи хранятся в бд с шифрованием пролей с помощью 
bcrypt. Сессии аутентификации хранятся в рантайме(так что если перезапустить 
приложение, то аутентификацию слетит). 
Полный путь получения доступа: инициировать регистрацию(один из двух методов),
получить ключ(или сообщение по почте) и использовать его в подтверждении 
регистрации, далее вызвать ручку логина с указанными при регистрации данными 
и у вас есть доступ к API

### Приложение имеет gRPC или HTTP API (минимум четыре бизнес-метода: создание, получение, изменение, удаление) (0.66 балла)

Программа представляет собой http сервис, общающийся посредством json 
сообщений. Есть основные методы для взаимодействия с todo: получения списка 
todo, получение отдельного todo, создание нового todo, удаление, смена 
статуса. Все операции работают в контексте пользователя, то есть разные 
пользователи имеют свои задачи и работают изолированно

### Все сервисы и API покрыты тестами (unit и функциональными) (0.66 балла)

Приложение довольно маленькое, так что unit тесты особо не нужны. 
Интеграционные тесты на всю бизнес логику находятся в классе 
[TodolistControllerTest](./src/test/java/ru/marattim/todolist/controller/TodolistControllerTest.java).
Для тестов используются средства spring, а именно аннотация SpringBootTest. 
Чтобы не поднимать отдельный контекст на каждый тест создана аннотация 
@IntegrationTest. Все тесты отмеченный ей будут запущены в рамках одного 
контекста. Для хранения данных используется эмбеддед постгрес. Запуск тестов 
включен в фазу сборки проекта

### Приложение использует внешнюю БД для хранения пользователей и бизнес информации (0.66 балла)

Для хранения данных используем внешнюю бд postgresql. 
Из интересного: для обновления колонки `last_modified_at` используем триггер 
на уровне бд(то есть даже меняя руками бд это время поменяется)

### Схема базы данных создаётся при запуске или деплое приложения, поддерживается версионирование схемы (0.66 балла)

Есть несколько механизмов миграций. Все они работают с помощью фреймворка 
liquibase. Есть задача миграции на уровне сборки приложения. Ее нужно 
выполнять перед тем как сгенерировать обновленные данные сущностей. Есть система
миграций на уровне java приложения, которая запускается перед стартом spring 
сервера. Она нужна, чтобы можно было распространять приложение без системы 
сборки. Третья система миграций находится в тестах и инициализирует 
встроенную базу данных postgres. Для кода миграций используется sql 

### Схема базы данных отражается в код при сборке. Несоответствие ORM-моделей, запросов и схемы приводит к ошибке сборки (0.66 балла)

Используется подход database first, то есть по базе данных генерируются 
таблицы. Для генерации используется фреймворк Jooq. Его настройка далась 
очень тяжело, так как он предназначен для maven, а для gradle очень мало 
инструкций, пришлось разбираться методом тыка. Большая часть build.gradle 
состоит из настройки Jooq. Если в базе данных поменяется какая-то колонка, 
то при неправильном ее использовании в коде проект упадет при сборке. Таким 
образом соответствие схемы и кода проверяется в компайл тайме







